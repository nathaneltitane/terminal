#!/bin/bash

# logout ///////////////////////////////////////////////////////////////////////

if [ -n "${TERMUX_VERSION}" ]
then
	frobulator.fwd "Logging out..."
	echo

	frobulator.timeout
fi

# dextop ///////////////////////////////////////////////////////////////////////

if [ -n "${TERMUX_VERSION}" ]
then
	# automatic session stop

	if [[ $(cat "${HOME}"/.dextop/dextop-logout) = "logout" ]]
	then
		# audio

		if [[ $(pidof pulseaudio) ]]
		then
			pulseaudio --kill
		fi

		#framebuffer

		if [[ $(pidof Xvfb) ]]
		then
			container-session -x
		fi

		# vnc

		if [[ $(pidof x11vnc) ]]
		then
			container-session -x
		fi

		# x11

		if [[ $(pidof app_process / com.termux.x11.Loader) ]]
		then
			container-session -x
		fi

		if [[ $(pidof com.termux.x11) ]]
		then
			termux_x11_activity="com.termux.x11,ACTION_STOP"

			display_activity="${termux_x11_activity}"

			# stop termux:x11 intent

			unset intent_command

			intent_command+="am broadcast"
			intent_command+=" --user 0"
			intent_command+=" -a ${display_activity}"
			intent_command+=" -p ${display_activity}"

			frobulator.silence "${intent_command}"

			container-session -x
		fi
	fi
fi
