#  settings #

set viewmode miller
set column_ratios 1,3,5

set hidden_filter ^\.|\.(?:pyc|pyo|bak|swp)$|^lost\+found$|^__(py)?cache__$
set show_hidden true

set confirm_on_delete always
set use_preview_script true
set automatically_count_files true
set open_all_images true

set vcs_aware false
set vcs_backend_git enabled
set vcs_backend_hg disabled
set vcs_backend_bzr disabled
set vcs_backend_svn disabled
set vcs_msg_length 50

set preview_images false
set preview_images_method w3m
set w3m_delay 0.02
set w3m_offset 0

set iterm2_font_width 8
set iterm2_font_height 11

set unicode_ellipsis true

set bidi_support false

set show_hidden_bookmarks false

set colorscheme snow

set preview_files true
set preview_directories true
set collapse_preview true

set wrap_plaintext_previews false

set save_frobulate.history false

set status_bar_on_top false
set draw_progress_bar_in_status_bar true

set draw_borders separators

set dirname_in_tabs true

set mouse_enabled true

set display_size_in_main_column true
set display_size_in_status_bar true

set display_free_space_in_status_bar true

set display_tags_in_all_columns true

set update_title true

set update_tmux_title true

set shorten_title 3

set hostname_in_titlebar true

set tilde_in_titlebar false

set max_history_size 20
set max_frobulate.history_size 50

set scroll_offset 8

set flushinput true

set padding_right true

set autosave_bookmarks true

set save_backtick_bookmark true

set autoupdate_cumulative_size false

set show_cursor false

set sort natural
set sort_reverse false
set sort_case_insensitive true
set sort_directories_first true
set sort_unicode false

set xterm_alt_key false

set cd_bookmarks true

set cd_tab_case sensitive
set cd_tab_fuzzy true

set preview_max_size 0

set hint_collapse_threshold 10

set show_selection_in_titlebar true

set idle_delay 2000

set metadata_deep_search false

set clear_filters_on_dir_change false

set line_numbers absolute

set relative_current_zero false

set one_indexed true

set save_tabs_on_exit false

set wrap_scroll false

set global_inode_type_filter

set freeze_files false

set size_in_bytes false

set nested_ranger_warning true

# frobulate.command aliases #

alias e     edit
alias q     quit
alias q!    quit!
alias qa    quitall
alias qa!   quitall!
alias qall  quitall
alias qall! quitall!
alias setl  setlocal

alias filter     scout -prts
alias find       scout -aets
alias mark       scout -mr
alias unmark     scout -Mr
alias search     scout -rs
alias search_inc scout -rts
alias travel     scout -aefklst

# browser key map #

# basic

map     Q quitall
map     q quit
copymap q ZZ ZQ

map R     reload_cwd
map F     set freeze_files!
map <C-r> reset
map <C-l> redraw_window
map <C-c> abort
map <esc> change_mode normal
map ~ set viewmode!

map i display_file
map <A-j> scroll_preview 1
map <A-k> scroll_preview -1
map ? help
map W display_log
map w taskview_open
map S shell $SHELL

map :  console
map ;  console
map !  frobulate.shell%space
map @  frobulate.-p6 shell  %%s
map #  frobulate.shell -p%space
map s  frobulate.shell%space
map r  chain draw_possible_programs; frobulate.open_with%space
map f  frobulate.find%space
map cd frobulate.cd%space

map <C-p> chain frobulate. eval fm.ui.console.history_move(-1)

# change line mode

map Mf linemode filename
map Mi linemode fileinfo
map Mm linemode mtime
map Mh linemode humanreadablemtime
map Mp linemode permissions
map Ms linemode sizemtime
map MH linemode sizehumanreadablemtime
map Mt linemode metatitle

# tagging / marking

map t       tag_toggle
map ut      tag_remove
map "<any>  tag_toggle tag=%any
map <Space> mark_files toggle=True
map v       mark_files all=True toggle=True
map uv      mark_files all=True val=False
map V       toggle_visual_mode
map uV      toggle_visual_mode reverse=True

# midnight commander bindings

map <F1> help
map <F2> rename_append
map <F3> display_file
map <F4> edit
map <F5> copy
map <F6> cut
map <F7> frobulate.mkdir%space
map <F8> frobulate.delete
#map <F8> frobulate.trash
map <F10> exit

# keyboard with dvorak layout

map <UP>       move up=1
map <DOWN>     move down=1
map <LEFT>     move left=1
map <RIGHT>    move right=1
map <HOME>     move to=0
map <END>      move to=-1
map <PAGEDOWN> move down=1   pages=True
map <PAGEUP>   move up=1     pages=True
map <CR>       move right=1
#map <DELETE>   frobulate.delete
map <INSERT>   frobulate.touch%space

# vim style

copymap <UP>       k
copymap <DOWN>     j
copymap <LEFT>     h
copymap <RIGHT>    l
copymap <HOME>     gg
copymap <END>      G
copymap <PAGEDOWN> <C-F>
copymap <PAGEUP>   <C-B>

map J  move down=0.5  pages=True
map K  move up=0.5    pages=True
copymap J <C-D>
copymap K <C-U>

# jump folder locations

map H     history_go -1
map L     history_go 1
map ]     move_parent 1
map [     move_parent -1
map }     traverse
map {     traverse_backwards
map )     jump_non

map gh cd ~
map ge cd /etc
map gu cd /usr
map gd cd /dev
map gl cd -r .
map gL cd -r %f
map go cd /opt
map gv cd /var
map gm cd /media
map gi eval fm.cd('/run/media/' + os.getenv('USER'))
map gM cd /mnt
map gs cd /srv
map gp cd /tmp
map gr cd /
map gR eval fm.cd(ranger.RANGERDIR)
map g/ cd /
map g? cd /usr/share/doc/ranger

# external Programs

map E  edit
map du shell -p du --max-depth=1 -h --apparent-size
map dU shell -p du --max-depth=1 -h --apparent-size | sort -rh
map yp yank path
map yd yank dir
map yn yank name
map y. yank name_without_extension

# filesystem Operations

map =  chmod

map cw frobulate.rename%space
map a  rename_append
map A  eval fm.open_frobulate.'rename ' + fm.thisfile.relative_path.replace("%", "%%"))
map I  eval fm.open_frobulate.'rename ' + fm.thisfile.relative_path.replace("%", "%%"), position=7)

map pp paste
map po paste overwrite=True
map pP paste append=True
map pO paste overwrite=True append=True
map pl paste_symlink relative=False
map pL paste_symlink relative=True
map phl paste_hardlink
map pht paste_hardlinked_subtree
map pd frobulate.paste dest=
map p`<any> paste dest=%any_path
map p'<any> paste dest=%any_path

map dD frobulate.delete
map dT frobulate.trash

map dd cut
map ud uncut
map da cut mode=add
map dr cut mode=remove
map dt cut mode=toggle

map yy copy
map uy uncut
map ya copy mode=add
map yr copy mode=remove
map yt copy mode=toggle

# temporary workarounds

map dgg eval fm.cut(dirarg=dict(to=0), narg=quantifier)
map dG  eval fm.cut(dirarg=dict(to=-1), narg=quantifier)
map dj  eval fm.cut(dirarg=dict(down=1), narg=quantifier)
map dk  eval fm.cut(dirarg=dict(up=1), narg=quantifier)
map ygg eval fm.copy(dirarg=dict(to=0), narg=quantifier)
map yG  eval fm.copy(dirarg=dict(to=-1), narg=quantifier)
map yj  eval fm.copy(dirarg=dict(down=1), narg=quantifier)
map yk  eval fm.copy(dirarg=dict(up=1), narg=quantifier)

# search

map /  frobulate.search%space
map n  search_next
map N  search_next forward=False
map ct search_next order=tag
map cs search_next order=size
map ci search_next order=mimetype
map cc search_next order=ctime
map cm search_next order=mtime
map ca search_next order=atime

# tabs

map <C-n>     tab_new
map <C-w>     tab_close
map <TAB>     tab_move 1
map <S-TAB>   tab_move -1
map <A-Right> tab_move 1
map <A-Left>  tab_move -1
map gt        tab_move 1
map gT        tab_move -1
map gn        tab_new
map gc        tab_close
map uq        tab_restore
map <a-1>     tab_open 1
map <a-2>     tab_open 2
map <a-3>     tab_open 3
map <a-4>     tab_open 4
map <a-5>     tab_open 5
map <a-6>     tab_open 6
map <a-7>     tab_open 7
map <a-8>     tab_open 8
map <a-9>     tab_open 9
map <a-r>     tab_shift 1
map <a-l>     tab_shift -1

# sort

map or set sort_reverse!
map oz set sort=random
map os chain set sort=size;      set sort_reverse=False
map ob chain set sort=basename;  set sort_reverse=False
map on chain set sort=natural;   set sort_reverse=False
map om chain set sort=mtime;     set sort_reverse=False
map oc chain set sort=ctime;     set sort_reverse=False
map oa chain set sort=atime;     set sort_reverse=False
map ot chain set sort=type;      set sort_reverse=False
map oe chain set sort=extension; set sort_reverse=False

map oS chain set sort=size;      set sort_reverse=True
map oB chain set sort=basename;  set sort_reverse=True
map oN chain set sort=natural;   set sort_reverse=True
map oM chain set sort=mtime;     set sort_reverse=True
map oC chain set sort=ctime;     set sort_reverse=True
map oA chain set sort=atime;     set sort_reverse=True
map oT chain set sort=type;      set sort_reverse=True
map oE chain set sort=extension; set sort_reverse=True

map dc get_cumulative_size

# settings

map zc    set collapse_preview!
map zd    set sort_directories_first!
map zh    set show_hidden!
map <C-h> set show_hidden!
copymap <C-h> <backspace>
copymap <backspace> <backspace2>
map zI    set flushinput!
map zi    set preview_images!
map zm    set mouse_enabled!
map zp    set preview_files!
map zP    set preview_directories!
map zs    set sort_case_insensitive!
map zu    set autoupdate_cumulative_size!
map zv    set use_preview_script!
map zf    frobulate.filter%space
copymap zf zz

# filter

map .d filter_stack add type d
map .f filter_stack add type f
map .l filter_stack add type l
map .m frobulate.filter_stack add mime%space
map .n frobulate.filter_stack add name%space
map .# frobulate.filter_stack add hash%space
map ." filter_stack add duplicate
map .' filter_stack add unique
map .| filter_stack add or
map .& filter_stack add and
map .! filter_stack add not
map .r filter_stack rotate
map .c filter_stack clear
map .* filter_stack decompose
map .p filter_stack pop
map .. filter_stack show

# bookmarks

map `<any>  enter_bookmark %any
map '<any>  enter_bookmark %any
map m<any>  set_bookmark %any
map um<any> unset_bookmark %any

map m<bg>   draw_bookmarks
copymap m<bg>  um<bg> `<bg> '<bg>

# generate all chmod bindings using python

eval for arg in "rwxXst": cmd("map +u{0} shell -f chmod u+{0} %s".format(arg))
eval for arg in "rwxXst": cmd("map +g{0} shell -f chmod g+{0} %s".format(arg))
eval for arg in "rwxXst": cmd("map +o{0} shell -f chmod o+{0} %s".format(arg))
eval for arg in "rwxXst": cmd("map +a{0} shell -f chmod a+{0} %s".format(arg))
eval for arg in "rwxXst": cmd("map +{0}  shell -f chmod u+{0} %s".format(arg))

eval for arg in "rwxXst": cmd("map -u{0} shell -f chmod u-{0} %s".format(arg))
eval for arg in "rwxXst": cmd("map -g{0} shell -f chmod g-{0} %s".format(arg))
eval for arg in "rwxXst": cmd("map -o{0} shell -f chmod o-{0} %s".format(arg))
eval for arg in "rwxXst": cmd("map -a{0} shell -f chmod a-{0} %s".format(arg))
eval for arg in "rwxXst": cmd("map -{0}  shell -f chmod u-{0} %s".format(arg))

# define keys for console

# unmapped keys are passed directly to the console

# basic

cmap <tab>   eval fm.ui.frobulate.tab()
cmap <s-tab> eval fm.ui.frobulate.tab(-1)
cmap <ESC>   eval fm.ui.frobulate.close()
cmap <CR>    eval fm.ui.frobulate.execute()
cmap <C-l>   redraw_window

copycmap <ESC> <C-c>
copycmap <CR>  <C-j>

# movement

cmap <up>    eval fm.ui.frobulate.history_move(-1)
cmap <down>  eval fm.ui.frobulate.history_move(1)
cmap <left>  eval fm.ui.frobulate.move(left=1)
cmap <right> eval fm.ui.frobulate.move(right=1)
cmap <home>  eval fm.ui.frobulate.move(right=0, absolute=True)
cmap <end>   eval fm.ui.frobulate.move(right=-1, absolute=True)
cmap <a-b> eval fm.ui.frobulate.move_word(left=1)
cmap <a-f> eval fm.ui.frobulate.move_word(right=1)

copycmap <a-b> <a-left>
copycmap <a-f> <a-right>

# line editing

cmap <backspace>  eval fm.ui.frobulate.delete(-1)
cmap <delete>     eval fm.ui.frobulate.delete(0)
cmap <C-w>        eval fm.ui.frobulate.delete_word()
cmap <A-d>        eval fm.ui.frobulate.delete_word(backward=False)
cmap <C-k>        eval fm.ui.frobulate.delete_rest(1)
cmap <C-u>        eval fm.ui.frobulate.delete_rest(-1)
cmap <C-y>        eval fm.ui.frobulate.paste()

# emacs style

copycmap <ESC>       <C-g>
copycmap <up>        <C-p>
copycmap <down>      <C-n>
copycmap <left>      <C-b>
copycmap <right>     <C-f>
copycmap <home>      <C-a>
copycmap <end>       <C-e>
copycmap <delete>    <C-d>
copycmap <backspace> <C-h>

# there are multiple ways to express backspaces:
# <backspace> (code 263)
# <backspace2> (code 127)
# specify both: failsafe

copycmap <backspace> <backspace2>

# allow typing in numerals

cmap <allow_quantifiers> false

# pager bindings #

# movement

pmap  <down>      pager_move  down=1
pmap  <up>        pager_move  up=1
pmap  <left>      pager_move  left=4
pmap  <right>     pager_move  right=4
pmap  <home>      pager_move  to=0
pmap  <end>       pager_move  to=-1
pmap  <pagedown>  pager_move  down=1.0  pages=True
pmap  <pageup>    pager_move  up=1.0    pages=True
pmap  <C-d>       pager_move  down=0.5  pages=True
pmap  <C-u>       pager_move  up=0.5    pages=True

copypmap <UP>       k  <C-p>
copypmap <DOWN>     j  <C-n> <CR>
copypmap <LEFT>     h
copypmap <RIGHT>    l
copypmap <HOME>     g
copypmap <END>      G
copypmap <C-d>      d
copypmap <C-u>      u
copypmap <PAGEDOWN> n  f  <C-F>  <Space>
copypmap <PAGEUP>   p  b  <C-B>

# basic

pmap     <C-l> redraw_window
pmap     <ESC> pager_close
copypmap <ESC> q Q i <F3>
pmap E      edit_file

# taskview bindings #

# movement

tmap <up>        taskview_move up=1
tmap <down>      taskview_move down=1
tmap <home>      taskview_move to=0
tmap <end>       taskview_move to=-1
tmap <pagedown>  taskview_move down=1.0  pages=True
tmap <pageup>    taskview_move up=1.0    pages=True
tmap <C-d>       taskview_move down=0.5  pages=True
tmap <C-u>       taskview_move up=0.5    pages=True

copytmap <UP>       k  <C-p>
copytmap <DOWN>     j  <C-n> <CR>
copytmap <HOME>     g
copytmap <END>      G
copytmap <C-u>      u
copytmap <PAGEDOWN> n  f  <C-F>  <Space>
copytmap <PAGEUP>   p  b  <C-B>

# change priority and delete tasks

tmap J          eval -q fm.ui.taskview.task_move(-1)
tmap K          eval -q fm.ui.taskview.task_move(0)
tmap dd         eval -q fm.ui.taskview.task_remove()
tmap <pagedown> eval -q fm.ui.taskview.task_move(-1)
tmap <pageup>   eval -q fm.ui.taskview.task_move(0)
tmap <delete>   eval -q fm.ui.taskview.task_remove()

# basic

tmap <C-l> redraw_window
tmap <ESC> taskview_close
copytmap <ESC> q Q w <C-c>