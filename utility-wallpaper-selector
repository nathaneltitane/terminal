#!/bin/bash

# dependencies #

if [[ -z $(command -v frobulator) ]]
then
	curl -s -L get.frbltr.app > "${PREFIX}"/bin/frobulator
fi

. "${PREFIX}"/bin/frobulator

# script #

script=$(basename -- "${BASH_SOURCE[0]}")

# version #

# usage #

# prompt #

# variables #

[[ $(id -u -n) = "root" ]] && home=/home/"${SUDO_USER:-$USER}" || home=/home/"${USER}"

# defaults #

# binary #

cat <<- 'FILE' > /usr/bin/wallpaper-selector
#!/bin/bash

# wallpaper selector #

rgb_to_hex () {
	IFS='(,)'

	read _ r g b <<< "${1}"

	printf '%02x%02x%02x\n' ${r} ${g} ${b}
}

hex_to_rgb () {
	read hex <<< "${1}"

	[[ ${hex:0:1} = "#" ]] && hex=${hex:1:6}

	r=$((16#${hex:0:2}))
	g=$((16#${hex:2:2}))
	b=$((16#${hex:4:2}))

	printf '%03d %03d %03d\n' ${r} ${g} ${b}
}

default_color="333333"

color_input="$(zenity --color-selection --color="#333333" --show-palette)"
color_selection=$(rgb_to_hex "$color_input")

if [[ "$color_input" != "" ]]
then
	color="#$color_selection"
else
	color="#$default_color"
fi

# desktop #

gsettings set org.gnome.desktop.background primary-color "$color"
gsettings set org.gnome.desktop.background secondary-color "$color"
gsettings set org.gnome.desktop.background picture-uri "''"

# lockscreen #

gsettings set org.gnome.desktop.screensaver primary-color "$color"
gsettings set org.gnome.desktop.screensaver secondary-color "$color"
gsettings set org.gnome.desktop.screensaver picture-uri "''"

# login screen #

gsettings set org.gnome.desktop.background primary-color "$color"
gsettings set org.gnome.desktop.background secondary-color "$color"
gsettings set org.gnome.desktop.background picture-uri "''"

picture_option=$(zenity --list --title "Select a picture option" --width="300" --height="250" --text="Specify an image layout option" --radiolist --column="Selection" --column="Option" \
TRUE "wallpaper" \
FALSE "center" \
FALSE "scaled" \
FALSE "stretched" \
FALSE "zoom" \
FALSE "spanned") 2> /dev/null || exit # Specify image layout option or exit on 'Cancel'

picture_uri=$(zenity --file-selection --separator=$'\n' --title="Select a Directory") 2> /dev/null || exit # Specify source image location or exit on 'Cancel'

# desktop #

gsettings set org.gnome.desktop.background picture-options "$picture_option"
gsettings set org.gnome.desktop.background picture-uri "file:///$picture_uri"


# lockscreen #

gsettings set org.gnome.desktop.screensaver picture-options "$picture_option"
gsettings set org.gnome.desktop.screensaver picture-uri "file:///$picture_uri"


# login screen #

sudo su gdm -s /bin/bash << FILE
gsettings set org.gnome.desktop.background picture-options "$picture_option"
gsettings set org.gnome.desktop.background picture-uri "file:///$picture_uri"

FILE

sudo chmod +x /usr/bin/wallpaper-selector

# generate launcher

cat <<- 'FILE' > /usr/share/applications/wallpaper-selector.desktop
[Desktop Entry]
Name=Wallpaper Selector
Comment=Select and configure desktop and lock screen background wallpapers
Exec=/usr/bin/wallpaper-selector
Icon=preferences-desktop-wallpaper
Terminal=false
Type=Application
StartupNotify=true
Categories=Utility;
FILE
