#!/bin/bash

# dextop ///////////////////////////////////////////////////////////////////////

if [ -f "${HOME}"/.dextop/dextop ]
then
	if [[ $(cat "${HOME}"/.dextop/dextop-option) = xfce ]]
	then
		session_name="XFCE"
	else
		session_name="CONSOLE"
	fi

	if [ -f /etc/os-release ]
	then
		. /etc/os-release

		name="${NAME}"
	fi

	# settings

	if [ ! -f "${HOME}"/.dextop/dextop-settings-checkpoint ]
	then
		frobulator.fwd "Setting up..."
		echo

		dbus-launch "${PREFIX}"/bin/container-settings

		frobulator.file "${HOME}"/.dextop dextop-settings-checkpoint

		frobulator.clear
	fi

	# update #

	if [[ $(pidof proot) ]]
	then
		:
	else
		if [[ $(cat "${HOME}"/.dextop/dextop-update) = "update" ]]
		then
			frobulator.fwd "Updating..."
			echo

			utilities_list+=(
				termux-directories
				termux-packages
				termux-repositories
				termux-storage
				termux-update
				container-expansion
				container-image
				container-packages
				container-repositories
				container-session
				container-settings
				container-system
				container-user
			)

			frobulator.download get.dxtp.app "${PREFIX}"/bin ${utilities_list[@]}

			frobulator.clear
		fi
	fi

	# automatic session start

	if [[ $(ps -A | grep -i vnc) ]]
	then
		:
	else
		if [[ $(pidof proot) ]]
		then
			if [ -f "${HOME}"/.vnc/selection ]
			then
				echo $(cat "${HOME}"/.vnc/selection) | container-session -o
			else
				container-session -o
			fi
		fi
	fi
fi
